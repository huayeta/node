/*! WebUploader 0.1.5 */
var jQuery=require("example:widget/ui/jquery/jquery.js");
return function(y,p){var C={},g=function(k,c){var b,a,f;if("string"===typeof k)return h(k);b=[];a=k.length;for(f=0;f<a;f++)b.push(h(k[f]));return c.apply(null,b)},h=function(k){var c=C[k]||y[k];if(!c)throw Error("`"+k+"` is undefined");return c};y.__dollar=jQuery;return function(k){var c,b,a,f,d,e;e=function(a){return a&&a.charAt(0).toUpperCase()+a.substr(1)};for(c in C)if(b=k,C.hasOwnProperty(c)){a=c.split("/");for(d=e(a.pop());f=e(a.shift());)b[f]=b[f]||{},b=b[f];b[d]=C[c]}return k}(p(y,function(k,
c,b){2===arguments.length&&(b=c,c=null);g(c||[],function(){var a=arguments,f={exports:b};"function"===typeof b&&(a.length||(a=[g,f.exports,f]),a=b.apply(null,a),void 0!==a&&(f.exports=a));C[k]=f.exports})},g))}(window,function(y,p,C){p("dollar-third",[],function(){var g=y.__dollar||y.jQuery||y.Zepto;if(!g)throw Error("jQuery or Zepto not found!");return g});p("dollar",["dollar-third"],function(g){return g});p("promise-third",["dollar"],function(g){return{Deferred:g.Deferred,when:g.when,isPromise:function(g){return g&&
"function"===typeof g.then}}});p("promise",["promise-third"],function(g){return g});p("base",["dollar","promise"],function(g,h){function k(a,b){return function(){return a.apply(b,arguments)}}function c(a){var b;if(Object.create)return Object.create(a);b=function(){};b.prototype=a;return new b}var b=function(){},a=Function.call,f=h.Deferred,d=h.isPromise,e=h.when,r=function(a){var b={},e=a.match(/WebKit\/([\d.]+)/),f=a.match(/Chrome\/([\d.]+)/)||a.match(/CriOS\/([\d.]+)/),c=a.match(/MSIE\s([\d\.]+)/)||
a.match(/(?:trident)(?:.*rv:([\w.]+))?/i),r=a.match(/Firefox\/([\d.]+)/),d=a.match(/Safari\/([\d.]+)/);a=a.match(/OPR\/([\d.]+)/);e&&(b.webkit=parseFloat(e[1]));f&&(b.chrome=parseFloat(f[1]));c&&(b.ie=parseFloat(c[1]));r&&(b.firefox=parseFloat(r[1]));d&&(b.safari=parseFloat(d[1]));a&&(b.opera=parseFloat(a[1]));return b}(navigator.userAgent),q=function(a){var b={},e=a.match(/(?:Android);?[\s\/]+([\d.]+)?/);a=a.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);e&&(b.android=parseFloat(e[1]));a&&(b.ios=parseFloat(a[1].replace(/_/g,
".")));return b}(navigator.userAgent),x;x=y.console?k(console.log,console):b;return{version:"0.1.5",$:g,Deferred:f,isPromise:d,when:e,browser:r,os:q,inherits:function(a,b,e){var f;"function"===typeof b?(f=b,b=null):f=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return a.apply(this,arguments)};g.extend(!0,f,a,e||{});f.__super__=a.prototype;f.prototype=c(a.prototype);b&&g.extend(!0,f.prototype,b);return f},noop:b,bindFn:k,log:x,nextTick:function(){return function(a){setTimeout(a,1)}}(),
slice:function(b){return function(){return a.apply(b,arguments)}}([].slice),guid:function(){var a=0;return function(b){for(var e=(+new Date).toString(32),f=0;5>f;f++)e+=Math.floor(65535*Math.random()).toString(32);return(b||"wu_")+e+(a++).toString(32)}}(),formatSize:function(a,b,e){var f;for(e=e||["B","K","M","G","TB"];(f=e.shift())&&1024<a;)a/=1024;return("B"===f?a:a.toFixed(b||2))+f}}});p("mediator",["base"],function(g){function h(a,f,c,d){return b.grep(a,function(a){return a&&(!f||a.e===f)&&(!c||
a.cb===c||a.cb._cb===c)&&(!d||a.ctx===d)})}function k(a,c,d){b.each((a||"").split(f),function(a,b){d(b,c)})}function c(a,b){for(var f=!1,c=-1,d=a.length,k;++c<d;)if(k=a[c],!1===k.cb.apply(k.ctx2,b)){f=!0;break}return!f}var b=g.$,a=[].slice,f=/\s+/,d;d={on:function(a,b,f){var c=this,d;if(!b)return this;d=this._events||(this._events=[]);k(a,b,function(a,b){var e={e:a};e.cb=b;e.ctx=f;e.ctx2=f||c;e.id=d.length;d.push(e)});return this},once:function(a,b,f){var c=this;if(!b)return c;k(a,b,function(a,b){var e=
function(){c.off(a,e);return b.apply(f||c,arguments)};e._cb=b;c.on(a,e,f)});return c},off:function(a,f,c){var d=this._events;if(!d)return this;if(!a&&!f&&!c)return this._events=[],this;k(a,f,function(a,f){b.each(h(d,a,f,c),function(){delete d[this.id]})});return this},trigger:function(b){var f,d,k;if(!this._events||!b)return this;f=a.call(arguments,1);d=h(this._events,b);k=h(this._events,"all");return c(d,f)&&c(k,arguments)}};return b.extend({installTo:function(a){return b.extend(a,d)}},d)});p("uploader",
["base","mediator"],function(g,h){function k(b){this.options=c.extend(!0,{},k.options,b);this._init(this.options)}var c=g.$;k.options={};h.installTo(k.prototype);c.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",getRuntimeType:"get-runtime-type",
refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(b,a){k.prototype[b]=function(){return this.request(a,arguments)}});c.extend(k.prototype,{state:"pending",_init:function(b){var a=this;a.request("init",b,function(){a.state="ready";a.trigger("ready")})},option:function(b,a){var f=this.options;if(1<arguments.length)c.isPlainObject(a)&&c.isPlainObject(f[b])?c.extend(f[b],a):f[b]=a;else return b?f[b]:f},getStats:function(){var b=this.request("get-stats");return{successNum:b.numOfSuccess,
progressNum:b.numOfProgress,cancelNum:b.numOfCancel,invalidNum:b.numOfInvalid,uploadFailNum:b.numOfUploadFailed,queueNum:b.numOfQueue}},trigger:function(b){var a=[].slice.call(arguments,1),f=this.options,d="on"+b.substring(0,1).toUpperCase()+b.substring(1);return!1===h.trigger.apply(this,arguments)||c.isFunction(f[d])&&!1===f[d].apply(this,a)||c.isFunction(this[d])&&!1===this[d].apply(this,a)||!1===h.trigger.apply(h,[this,b].concat(a))?!1:!0},request:g.noop});g.create=k.create=function(b){return new k(b)};
return g.Uploader=k});p("runtime/runtime",["base","mediator"],function(g,h){function k(a){this.options=c.extend({container:document.body},a);this.uid=g.guid("rt_")}var c=g.$,b={},a=function(a){for(var b in a)if(a.hasOwnProperty(b))return b;return null};c.extend(k.prototype,{getContainer:function(){var a,b;if(this._container)return this._container;a=c(this.options.container||document.body);b=c(document.createElement("div"));b.attr("id","rt_"+this.uid);b.css({position:"absolute",top:"0px",left:"0px",
width:"1px",height:"1px",overflow:"hidden"});a.append(b);a.addClass("webuploader-container");return this._container=b},init:g.noop,exec:g.noop,destroy:function(){this._container&&this._container.parentNode.removeChild(this.__container);this.off()}});k.orders="html5,flash";k.addRuntime=function(a,c){b[a]=c};k.hasRuntime=function(f){return!(f?!b[f]:!a(b))};k.create=function(f,d){var e;d=d||k.orders;c.each(d.split(/\s*,\s*/g),function(){if(b[this])return e=this,!1});e=e||a(b);if(!e)throw Error("Runtime Error");
return new b[e](f)};h.installTo(k.prototype);return k});p("runtime/client",["base","mediator","runtime/runtime"],function(g,h,k){function c(a,f){var c=g.Deferred(),e;this.uid=g.guid("client_");this.runtimeReady=function(a){return c.done(a)};this.connectRuntime=function(a,q){if(e)throw Error("already connected!");c.done(q);"string"===typeof a&&b.get(a)&&(e=b.get(a));(e=e||b.get(null,f))?(g.$.extend(e.options,a),e.__promise.then(c.resolve),e.__client++):(e=k.create(a,a.runtimeOrder),e.__promise=c.promise(),
e.once("ready",c.resolve),e.init(),b.add(e),e.__client=1);f&&(e.__standalone=f);return e};this.getRuntime=function(){return e};this.disconnectRuntime=function(){e&&(e.__client--,0>=e.__client&&(b.remove(e),delete e.__promise,e.destroy()),e=null)};this.exec=function(){if(e){var b=g.slice(arguments);a&&b.unshift(a);return e.exec.apply(this,b)}};this.getRuid=function(){return e&&e.uid};this.destroy=function(a){return function(){a&&a.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");
this.disconnectRuntime()}}(this.destroy)}var b;b=function(){var a={};return{add:function(b){a[b.uid]=b},get:function(b,c){var e;if(b)return a[b];for(e in a)if(!c||!a[e].__standalone)return a[e];return null},remove:function(b){delete a[b.uid]}}}();h.installTo(c.prototype);return c});p("lib/dnd",["base","mediator","runtime/client"],function(g,h,k){function c(a){a=this.options=b.extend({},c.options,a);a.container=b(a.container);a.container.length&&k.call(this,"DragAndDrop")}var b=g.$;c.options={accept:null,
disableGlobalDnd:!1};g.inherits(k,{constructor:c,init:function(){var a=this;a.connectRuntime(a.options,function(){a.exec("init");a.trigger("ready")})},destroy:function(){this.disconnectRuntime()}});h.installTo(c.prototype);return c});p("widgets/widget",["base","uploader"],function(g,h){function k(a){if(!a)return!1;var f=a.length,c=b.type(a);return 1===a.nodeType&&f?!0:"array"===c||"function"!==c&&"string"!==c&&(0===f||"number"===typeof f&&0<f&&f-1 in a)}function c(a){this.owner=a;this.options=a.options}
var b=g.$,a=h.prototype._init,f={},d=[];b.extend(c.prototype,{init:g.noop,invoke:function(a,c){var d=this.responseMap;return d&&a in d&&d[a]in this&&b.isFunction(this[d[a]])?this[d[a]].apply(this,c):f},request:function(){return this.owner.request.apply(this.owner,arguments)}});b.extend(h.prototype,{_init:function(){var f=this,c=f._widgets=[];b.each(d,function(a,b){c.push(new b(f))});return a.apply(f,arguments)},request:function(a,b,c){var d=0,h=this._widgets,s=h.length,v=[],w=[],u;for(b=k(b)?b:[b];d<
s;d++)u=h[d],u=u.invoke(a,b),u!==f&&(g.isPromise(u)?w.push(u):v.push(u));return c||w.length?(a=g.when.apply(g,w),b=a.pipe?"pipe":"then",a[b](function(){var a=g.Deferred(),b=arguments;1===b.length&&(b=b[0]);setTimeout(function(){a.resolve(b)},1);return a.promise()})[c?b:"done"](c||g.noop)):v[0]}});h.register=c.register=function(a,f){var q={init:"init"};1===arguments.length?(f=a,f.responseMap=q):f.responseMap=b.extend(q,a);q=g.inherits(c,f);d.push(q);return q};return c});p("widgets/filednd",["base",
"uploader","lib/dnd","widgets/widget"],function(g,h,k){var c=g.$;h.options.dnd="";return h.register({init:function(b){if(b.dnd&&"html5"===this.request("predict-runtime-type")){var a=this,f=g.Deferred();b=c.extend({},{disableGlobalDnd:b.disableGlobalDnd,container:b.dnd,accept:b.accept});b=new k(b);b.once("ready",f.resolve);b.on("drop",function(b){a.request("add-file",[b])});b.on("accept",function(b){return a.owner.trigger("dndAccept",b)});b.init();return f.promise()}}})});p("lib/filepaste",["base",
"mediator","runtime/client"],function(g,h,k){function c(a){a=this.options=b.extend({},a);a.container=b(a.container||document.body);k.call(this,"FilePaste")}var b=g.$;g.inherits(k,{constructor:c,init:function(){var a=this;a.connectRuntime(a.options,function(){a.exec("init");a.trigger("ready")})},destroy:function(){this.exec("destroy");this.disconnectRuntime();this.off()}});h.installTo(c.prototype);return c});p("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(g,h,k){var c=
g.$;return h.register({init:function(b){if(b.paste&&"html5"===this.request("predict-runtime-type")){var a=this,f=g.Deferred();b=c.extend({},{container:b.paste,accept:b.accept});b=new k(b);b.once("ready",f.resolve);b.on("paste",function(b){a.owner.request("add-file",[b])});b.init();return f.promise()}}})});p("lib/blob",["base","runtime/client"],function(g,h){function k(c,b){this.source=b;this.ruid=c;this.size=b.size||0;!b.type&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)?this.type="image/"+("jpg"===
this.ext?"jpeg":this.ext):this.type=b.type||"application/octet-stream";h.call(this,"Blob");this.uid=b.uid||this.uid;c&&this.connectRuntime(c)}g.inherits(h,{constructor:k,slice:function(c,b){return this.exec("slice",c,b)},getSource:function(){return this.source}});return k});p("lib/file",["base","lib/blob"],function(g,h){var k=1,c=/\.([^.]+)$/;return g.inherits(h,function(b,a){var f;this.name=a.name||"untitled"+k++;f=c.exec(a.name)?RegExp.$1.toLowerCase():"";!f&&a.type&&(f=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(a.type)?
RegExp.$1.toLowerCase():"",this.name+="."+f);this.ext=f;this.lastModifiedDate=a.lastModifiedDate||(new Date).toLocaleString();h.apply(this,arguments)})});p("lib/filepicker",["base","runtime/client","lib/file"],function(g,h,k){function c(a){a=this.options=b.extend({},c.options,a);a.container=b(a.id);if(!a.container.length)throw Error("\u6309\u94ae\u6307\u5b9a\u9519\u8bef");a.innerHTML=a.innerHTML||a.label||a.container.html()||"";a.button=b(a.button||document.createElement("div"));a.button.html(a.innerHTML);
a.container.html(a.button);h.call(this,"FilePicker",!0)}var b=g.$;c.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file"};g.inherits(h,{constructor:c,init:function(){var a=this,f=a.options,c=f.button;c.addClass("webuploader-pick");a.on("all",function(e){switch(e){case "mouseenter":c.addClass("webuploader-pick-hover");break;case "mouseleave":c.removeClass("webuploader-pick-hover");break;case "change":e=a.exec("getFiles"),a.trigger("select",b.map(e,function(b){b=
new k(a.getRuid(),b);b._refer=f.container;return b}),f.container)}});a.connectRuntime(f,function(){a.refresh();a.exec("init",f);a.trigger("ready")});b(y).on("resize",function(){a.refresh()})},refresh:function(){var a=this.getRuntime().getContainer(),b=this.options.button,c=b.outerWidth?b.outerWidth():b.width(),e=b.outerHeight?b.outerHeight():b.height(),b=b.offset();c&&e&&a.css({bottom:"auto",right:"auto",width:c+"px",height:e+"px"}).offset(b)},enable:function(){this.options.button.removeClass("webuploader-pick-disable");
this.refresh()},disable:function(){var a=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});a.addClass("webuploader-pick-disable")},destroy:function(){this.runtime&&(this.exec("destroy"),this.disconnectRuntime())}});return c});p("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(g,h,k){var c=g.$;c.extend(h.options,{pick:null,accept:null});return h.register({"add-btn":"addButton",refresh:"refresh",disable:"disable",enable:"enable"},{init:function(b){this.pickers=
[];return b.pick&&this.addButton(b.pick)},refresh:function(){c.each(this.pickers,function(){this.refresh()})},addButton:function(b){var a=this,f=a.options,d=f.accept,e=[];if(b)return c.isPlainObject(b)||(b={id:b}),c(b.id).each(function(){var r,q;q=g.Deferred();r=c.extend({},b,{accept:c.isPlainObject(d)?[d]:d,swf:f.swf,runtimeOrder:f.runtimeOrder,id:this});r=new k(r);r.once("ready",q.resolve);r.on("select",function(b){a.owner.request("add-file",[b])});r.init();a.pickers.push(r);e.push(q.promise())}),
g.when.apply(g,e)},disable:function(){c.each(this.pickers,function(){this.disable()})},enable:function(){c.each(this.pickers,function(){this.enable()})}})});p("lib/image",["base","runtime/client","lib/blob"],function(g,h,k){function c(a){this.options=b.extend({},c.options,a);h.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}var b=g.$;c.options={quality:90,crop:!1,preserveHeaders:!1,allowMagnify:!1};g.inherits(h,{constructor:c,info:function(a){return a?
(this._info=a,this):this._info},meta:function(a){return a?(this._meta=a,this):this._meta},loadFromBlob:function(a){var b=this,c=a.getRuid();this.connectRuntime(c,function(){b.exec("init",b.options);b.exec("loadFromBlob",a)})},resize:function(){var a=g.slice(arguments);return this.exec.apply(this,["resize"].concat(a))},crop:function(){var a=g.slice(arguments);return this.exec.apply(this,["crop"].concat(a))},getAsDataUrl:function(a){return this.exec("getAsDataUrl",a)},getAsBlob:function(a){a=this.exec("getAsBlob",
a);return new k(this.getRuid(),a)}});return c});p("widgets/image",["base","uploader","lib/image","widgets/widget"],function(g,h,k){var c=g.$,b;b=function(a){var b=0,c=[],e=function(){for(var e;c.length&&b<a;)e=c.shift(),b+=e[0],e[1]()};return function(a,q,k){c.push([q,k]);a.once("destroy",function(){b-=q;setTimeout(e,1)});setTimeout(e,1)}}(5242880);c.extend(h.options,{thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,
quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}});return h.register({"make-thumb":"makeThumb","before-send-file":"compressImage"},{makeThumb:function(a,f,d,e){var r,q;a=this.request("get-file",a);a.type.match(/^image/)?(r=c.extend({},this.options.thumb),c.isPlainObject(d)&&(r=c.extend(r,d),d=null),d=d||r.width,e=e||r.height,q=new k(r),q.once("load",function(){a._info=a._info||q.info();a._meta=a._meta||q.meta();1>=d&&0<d&&(d*=a._info.width);1>=e&&0<e&&(e*=a._info.height);q.resize(d,e)}),q.once("complete",
function(){f(!1,q.getAsDataUrl(r.type));q.destroy()}),q.once("error",function(a){f(a||!0);q.destroy()}),b(q,a.source.size,function(){a._info&&q.info(a._info);a._meta&&q.meta(a._meta);q.loadFromBlob(a.source)})):f(!0)},compressImage:function(a){var b=this.options.compress||this.options.resize,d=b&&b.compressSize||0,e=b&&b.noCompressIfLarger||!1,r,q;a=this.request("get-file",a);if(b&&~"image/jpeg,image/jpg".indexOf(a.type)&&!(a.size<d)&&!a._compressed)return b=c.extend({},b),q=g.Deferred(),r=new k(b),
q.always(function(){r.destroy();r=null}),r.once("error",q.reject),r.once("load",function(){var c=b.width,e=b.height;a._info=a._info||r.info();a._meta=a._meta||r.meta();1>=c&&0<c&&(c*=a._info.width);1>=e&&0<e&&(e*=a._info.height);r.resize(c,e)}),r.once("complete",function(){var c,d;try{c=r.getAsBlob(b.type);d=a.size;if(!e||c.size<d)a.source=c,a.size=c.size,a.trigger("resize",c.size,d);a._compressed=!0;q.resolve()}catch(k){q.resolve()}}),a._info&&r.info(a._info),a._meta&&r.meta(a._meta),r.loadFromBlob(a.source),
q.promise()}})});p("file",["base","mediator"],function(g,h){function k(f){this.name=f.name||"Untitled";this.size=f.size||0;this.type=f.type||"application";this.lastModifiedDate=f.lastModifiedDate||1*new Date;this.id="WU_FILE_"+c++;this.ext=b.exec(this.name)?RegExp.$1:"";this.statusText="";a[this.id]=k.Status.INITED;this.source=f;this.loaded=0;this.on("error",function(a){this.setStatus(k.Status.ERROR,a)})}var c=0,b=/\.([^.]+)$/,a={};g.$.extend(k.prototype,{setStatus:function(b,c){var e=a[this.id];
"undefined"!==typeof c&&(this.statusText=c);b!==e&&(a[this.id]=b,this.trigger("statuschange",b,e))},getStatus:function(){return a[this.id]},getSource:function(){return this.source},destory:function(){delete a[this.id]}});h.installTo(k.prototype);k.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};return k});p("queue",["base","mediator","file"],function(g,h,k){function c(){this.stats={numOfQueue:0,
numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0};this._queue=[];this._map={}}var b=g.$,a=k.Status;b.extend(c.prototype,{append:function(a){this._queue.push(a);this._fileAdded(a);return this},prepend:function(a){this._queue.unshift(a);this._fileAdded(a);return this},getFile:function(a){return"string"!==typeof a?a:this._map[a]},fetch:function(b){var c=this._queue.length,e,r;b=b||a.QUEUED;for(e=0;e<c;e++)if(r=this._queue[e],b===r.getStatus())return r;return null},sort:function(a){"function"===
typeof a&&this._queue.sort(a)},getFiles:function(){for(var a=[].slice.call(arguments,0),c=[],e=0,r=this._queue.length,k;e<r;e++)k=this._queue[e],a.length&&!~b.inArray(k.getStatus(),a)||c.push(k);return c},_fileAdded:function(b){var c=this;this._map[b.id]||(this._map[b.id]=b,b.on("statuschange",function(a,b){c._onFileStatusChange(a,b)}));b.setStatus(a.QUEUED)},_onFileStatusChange:function(b,c){var e=this.stats;switch(c){case a.PROGRESS:e.numOfProgress--;break;case a.QUEUED:e.numOfQueue--;break;case a.ERROR:e.numOfUploadFailed--;
break;case a.INVALID:e.numOfInvalid--}switch(b){case a.QUEUED:e.numOfQueue++;break;case a.PROGRESS:e.numOfProgress++;break;case a.ERROR:e.numOfUploadFailed++;break;case a.COMPLETE:e.numOfSuccess++;break;case a.CANCELLED:e.numOfCancel++;break;case a.INVALID:e.numOfInvalid++}}});h.installTo(c.prototype);return c});p("widgets/queue","base uploader queue file lib/file runtime/client widgets/widget".split(" "),function(g,h,k,c,b,a){var f=g.$,d=/\.\w+$/,e=c.Status;return h.register({"sort-files":"sortFiles",
"add-file":"addFiles","get-file":"getFile","fetch-file":"fetchFile","get-stats":"getStats","get-files":"getFiles","remove-file":"removeFile",retry:"retry",reset:"reset","accept-file":"acceptFile"},{init:function(b){var c=this,e,d,s,v,w,u,l;f.isPlainObject(b.accept)&&(b.accept=[b.accept]);if(b.accept){w=[];s=0;for(d=b.accept.length;s<d;s++)(v=b.accept[s].extensions)&&w.push(v);w.length&&(u="\\."+w.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$");c.accept=new RegExp(u,"i")}c.queue=new k;c.stats=
c.queue.stats;if("html5"===this.request("predict-runtime-type"))return e=g.Deferred(),l=new a("Placeholder"),l.connectRuntime({runtimeOrder:"html5"},function(){c._ruid=l.getRuid();e.resolve()}),e.promise()},_wrapFile:function(a){if(!(a instanceof c)){if(!(a instanceof b)){if(!this._ruid)throw Error("Can't add external files.");a=new b(this._ruid,a)}a=new c(a)}return a},acceptFile:function(a){return!(!a||6>a.size||this.accept&&d.exec(a.name)&&!this.accept.test(a.name))},_addFile:function(a){a=this._wrapFile(a);
if(this.owner.trigger("beforeFileQueued",a)){if(this.acceptFile(a))return this.queue.append(a),this.owner.trigger("fileQueued",a),a;this.owner.trigger("error","Q_TYPE_DENIED",a)}},getFile:function(a){return this.queue.getFile(a)},addFiles:function(a){var b=this;a.length||(a=[a]);a=f.map(a,function(a){return b._addFile(a)});b.owner.trigger("filesQueued",a);b.options.auto&&setTimeout(function(){b.request("start-upload")},20)},getStats:function(){return this.stats},removeFile:function(a){a=a.id?a:this.queue.getFile(a);
a.setStatus(e.CANCELLED);this.owner.trigger("fileDequeued",a)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(a,b){var c,f,d;if(a)a=a.id?a:this.queue.getFile(a),a.setStatus(e.QUEUED),b||this.request("start-upload");else{c=this.queue.getFiles(e.ERROR);f=0;for(d=c.length;f<d;f++)a=c[f],a.setStatus(e.QUEUED);this.request("start-upload")}},sortFiles:function(){return this.queue.sort.apply(this.queue,
arguments)},reset:function(){this.owner.trigger("reset");this.queue=new k;this.stats=this.queue.stats}})});p("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(g,h){g.support=function(){return h.hasRuntime.apply(h,arguments)};return g.register({"predict-runtime-type":"predictRuntmeType"},{init:function(){if(!this.predictRuntmeType())throw Error("Runtime Error");},predictRuntmeType:function(){var k=this.options.runtimeOrder||h.orders,c=this.type,b,a;if(!c)for(k=k.split(/\s*,\s*/g),
b=0,a=k.length;b<a;b++)if(h.hasRuntime(k[b])){this.type=c=k[b];break}return c}})});p("lib/transport",["base","runtime/client","mediator"],function(g,h,k){function c(a){var f=this;a=f.options=b.extend(!0,{},c.options,a||{});h.call(this,"Transport");this._blob=null;this._formData=a.formData||{};this._headers=a.headers||{};this.on("progress",this._timeout);this.on("load error",function(){f.trigger("progress",1);clearTimeout(f._timer)})}var b=g.$;c.options={server:"",method:"POST",withCredentials:!1,
fileVal:"file",timeout:12E4,formData:{},headers:{},sendAsBinary:!1};b.extend(c.prototype,{appendBlob:function(a,b,c){var e=this,r=e.options;e.getRuid()&&e.disconnectRuntime();e.connectRuntime(b.ruid,function(){e.exec("init")});e._blob=b;r.fileVal=a||r.fileVal;r.filename=c||r.filename},append:function(a,c){"object"===typeof a?b.extend(this._formData,a):this._formData[a]=c},setRequestHeader:function(a,c){"object"===typeof a?b.extend(this._headers,a):this._headers[a]=c},send:function(a){this.exec("send",
a);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var a=this,b=a.options.timeout;b&&(clearTimeout(a._timer),a._timer=setTimeout(function(){a.abort();a.trigger("error",
"timeout")},b))}});k.installTo(c.prototype);return c});p("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(g,h,k,c){function b(a,b){for(var c=[],f=a.source.size,d=b?Math.ceil(f/b):1,k=0,v=0,w;v<d;)w=Math.min(b,f-k),c.push({file:a,start:k,end:b?k+w:f,total:f,chunks:d,chunk:v++}),k+=w;a.blocks=c.concat();a.remaning=c.length;return{file:a,has:function(){return!!c.length},fetch:function(){return c.shift()}}}var a=g.$,f=g.isPromise,d=k.Status;a.extend(h.options,{prepareNextFile:!1,
chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:null});h.register({"start-upload":"start","stop-upload":"stop","skip-file":"skipFile","is-in-progress":"isInProgress"},{init:function(){var b=this.owner;this.runing=!1;this.pool=[];this.pending=[];this.remaning=0;this.__tick=g.bindFn(this._tick,this);b.on("uploadComplete",function(b){b.blocks&&a.each(b.blocks,function(a,b){b.transport&&(b.transport.abort(),b.transport.destroy());delete b.transport});delete b.blocks;delete b.remaning})},
start:function(){var b=this;a.each(b.request("get-files",d.INVALID),function(){b.request("remove-file",this)});b.runing||(b.runing=!0,a.each(b.pool,function(a,c){var f=c.file;f.getStatus()===d.INTERRUPT&&(f.setStatus(d.PROGRESS),b._trigged=!1,c.transport&&c.transport.send())}),b._trigged=!1,b.owner.trigger("startUpload"),g.nextTick(b.__tick))},stop:function(b){!1!==this.runing&&(this.runing=!1,b&&a.each(this.pool,function(a,b){b.transport&&b.transport.abort();b.file.setStatus(d.INTERRUPT)}),this.owner.trigger("stopUpload"))},
isInProgress:function(){return!!this.runing},getStats:function(){return this.request("get-stats")},skipFile:function(b,c){b=this.request("get-file",b);b.setStatus(c||d.COMPLETE);b.skipped=!0;b.blocks&&a.each(b.blocks,function(a,b){var c=b.transport;c&&(c.abort(),c.destroy(),delete b.transport)});this.owner.trigger("uploadSkip",b)},_tick:function(){var a=this,b=a.options,c;if(a._promise)return a._promise.always(a.__tick);a.pool.length<b.threads&&(c=a._nextBlock())?(a._trigged=!1,b=function(b){a._promise=
null;b&&b.file&&a._startSend(b);g.nextTick(a.__tick)},a._promise=f(c)?c.always(b):b(c)):a.remaning||a.getStats().numOfQueue||(a.runing=!1,a._trigged||g.nextTick(function(){a.owner.trigger("uploadFinished")}),a._trigged=!0)},_nextBlock:function(){var a=this,c=a._act,k=a.options,g,h;if(c&&c.has()&&c.file.getStatus()===d.PROGRESS)return k.prepareNextFile&&!a.pending.length&&a._prepareNextFile(),c.fetch();if(a.runing)return!a.pending.length&&a.getStats().numOfQueue&&a._prepareNextFile(),g=a.pending.shift(),
h=function(f){if(!f)return null;c=b(f,k.chunked?k.chunkSize:0);a._act=c;return c.fetch()},f(g)?g[g.pipe?"pipe":"then"](h):h(g)},_prepareNextFile:function(){var b=this,c=b.request("fetch-file"),f=b.pending,k;c&&(k=b.request("before-send-file",c,function(){return c.getStatus()===d.QUEUED?(b.owner.trigger("uploadStart",c),c.setStatus(d.PROGRESS),c):b._finishFile(c)}),k.done(function(){var b=a.inArray(k,f);~b&&f.splice(b,1,c)}),k.fail(function(a){c.setStatus(d.ERROR,a);b.owner.trigger("uploadError",c,
a);b.owner.trigger("uploadComplete",c)}),f.push(k))},_popBlock:function(b){var c=a.inArray(b,this.pool);this.pool.splice(c,1);b.file.remaning--;this.remaning--},_startSend:function(a){var b=this,c=a.file;b.pool.push(a);b.remaning++;a.blob=1===a.chunks?c.source:c.source.slice(a.start,a.end);b.request("before-send",a,function(){c.getStatus()===d.PROGRESS?b._doSend(a):(b._popBlock(a),g.nextTick(b.__tick))}).fail(function(){1===c.remaning?b._finishFile(c).always(function(){a.percentage=1;b._popBlock(a);
b.owner.trigger("uploadComplete",c);g.nextTick(b.__tick)}):(a.percentage=1,b._popBlock(a),g.nextTick(b.__tick))})},_doSend:function(b){var f=this,k=f.owner,h=f.options,m=b.file,s=new c(h),v=a.extend({},h.formData),w=a.extend({},h.headers),u,l;b.transport=s;s.on("destroy",function(){delete b.transport;f._popBlock(b);g.nextTick(f.__tick)});s.on("progress",function(c){var f=0,d=0,f=b.percentage=c;1<b.chunks&&(a.each(m.blocks,function(a,b){d+=(b.percentage||0)*(b.end-b.start)}),f=d/m.size);k.trigger("uploadProgress",
m,f||0)});u=function(a){l=s.getResponseAsJson()||{};l._raw=s.getResponse();k.trigger("uploadAccept",b,l,function(b){a=b})||(a=a||"server");return a};s.on("error",function(a,c){b.retried=b.retried||0;1<b.chunks&&~"http,abort".indexOf(a)&&b.retried<h.chunkRetry?(b.retried++,s.send()):(c||"server"!==a||(a=u(a)),m.setStatus(d.ERROR,a),k.trigger("uploadError",m,a),k.trigger("uploadComplete",m))});s.on("load",function(){var a;(a=u())?s.trigger("error",a,!0):1===m.remaning?f._finishFile(m,l):s.destroy()});
v=a.extend(v,{id:m.id,name:m.name,type:m.type,lastModifiedDate:m.lastModifiedDate,size:m.size});1<b.chunks&&a.extend(v,{chunks:b.chunks,chunk:b.chunk});k.trigger("uploadBeforeSend",b,v,w);s.appendBlob(h.fileVal,b.blob,m.name);s.append(v);s.setRequestHeader(w);s.send()},_finishFile:function(a,b,c){var f=this.owner;return f.request("after-send-file",arguments,function(){a.setStatus(d.COMPLETE);f.trigger("uploadSuccess",a,b,c)}).fail(function(b){a.getStatus()===d.PROGRESS&&a.setStatus(d.ERROR,b);f.trigger("uploadError",
a,b)}).always(function(){f.trigger("uploadComplete",a)})}})});p("widgets/validator",["base","uploader","file","widgets/widget"],function(g,h,k){var c=g.$,b={},a;a={addValidator:function(a,c){b[a]=c},removeValidator:function(a){delete b[a]}};h.register({init:function(){var a=this;g.nextTick(function(){c.each(b,function(){this.call(a.owner)})})}});a.addValidator("fileNumLimit",function(){var a=0,b=parseInt(this.options.fileNumLimit,10),c=!0;b&&(this.on("beforeFileQueued",function(k){a>=b&&c&&(c=!1,
this.trigger("error","Q_EXCEED_NUM_LIMIT",b,k),setTimeout(function(){c=!0},1));return a>=b?!1:!0}),this.on("fileQueued",function(){a++}),this.on("fileDequeued",function(){a--}),this.on("uploadFinished reset",function(){a=0}))});a.addValidator("fileSizeLimit",function(){var a=0,b=this.options.fileSizeLimit>>0,c=!0;b&&(this.on("beforeFileQueued",function(k){var g=a+k.size>b;g&&c&&(c=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",b,k),setTimeout(function(){c=!0},1));return g?!1:!0}),this.on("fileQueued",
function(b){a+=b.size}),this.on("fileDequeued",function(b){a-=b.size}),this.on("uploadFinished reset",function(){a=0}))});a.addValidator("fileSingleSizeLimit",function(){var a=this.options.fileSingleSizeLimit;if(a)this.on("beforeFileQueued",function(b){if(b.size>a)return b.setStatus(k.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",b),!1})});a.addValidator("duplicate",function(){var a={};this.options.duplicate||(this.on("beforeFileQueued",function(b){var c;if(!(c=b.__hash)){c=b.name+
b.size+b.lastModifiedDate;for(var k=0,g=0,h=c.length,m;g<h;g++)m=c.charCodeAt(g),k=m+(k<<6)+(k<<16)-k;c=b.__hash=k}if(a[c])return this.trigger("error","F_DUPLICATE",b),!1}),this.on("fileQueued",function(b){(b=b.__hash)&&(a[b]=!0)}),this.on("fileDequeued",function(b){(b=b.__hash)&&delete a[b]}),this.on("reset",function(){a={}}))});return a});p("lib/md5",["runtime/client","mediator"],function(g,h){function k(){g.call(this,"Md5")}h.installTo(k.prototype);k.prototype.loadFromBlob=function(c){var b=this;
b.getRuid()&&b.disconnectRuntime();b.connectRuntime(c.ruid,function(){b.exec("init");b.exec("loadFromBlob",c)})};k.prototype.getResult=function(){return this.exec("getResult")};return k});p("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(g,h,k,c){return h.register({"md5-file":"md5Blob"},{md5Blob:function(b,a,f){var d=new k,e=g.Deferred(),h=b instanceof c?b:this.request("get-file",b).source;d.on("progress load",function(a){a=a||{};e.notify(a.total?a.loaded/a.total:
1)});d.on("complete",function(){e.resolve(d.getResult())});d.on("error",function(a){e.reject(a)});1<arguments.length&&(a=a||0,f=f||0,0>a&&(a=h.size+a),0>f&&(f=h.size+f),f=Math.min(f,h.size),h=h.slice(a,f));d.loadFromBlob(h);return e.promise()}})});p("runtime/compbase",[],function(){return function(g,h){this.owner=g;this.options=g.options;this.getRuntime=function(){return h};this.getRuid=function(){return h.uid};this.trigger=function(){return g.trigger.apply(g,arguments)}}});p("runtime/html5/runtime",
["base","runtime/runtime","runtime/compbase"],function(g,h,k){function c(){var a={},c=this,d=this.destory;h.apply(c,arguments);c.type="html5";c.exec=function(d,k){var h=this.uid,x=g.slice(arguments,2);if(b[d]&&(h=a[h]=a[h]||new b[d](this,c),h[k]))return h[k].apply(h,x)};c.destory=function(){return d&&d.apply(this,arguments)}}var b={};g.inherits(h,{constructor:c,init:function(){var a=this;setTimeout(function(){a.trigger("ready")},1)}});c.register=function(a,c){return b[a]=g.inherits(k,c)};y.Blob&&
y.FileReader&&y.DataView&&h.addRuntime("html5",c);return c});p("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(g,h){return g.register("Blob",{slice:function(k,c){var b=this.owner.source,b=(b.slice||b.webkitSlice||b.mozSlice).call(b,k,c);return new h(this.getRuid(),b)}})});p("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(g,h,k){var c=g.$;return h.register("DragAndDrop",{init:function(){var b=this.elem=this.options.container;this.dragEnterHandler=g.bindFn(this._dragEnterHandler,
this);this.dragOverHandler=g.bindFn(this._dragOverHandler,this);this.dragLeaveHandler=g.bindFn(this._dragLeaveHandler,this);this.dropHandler=g.bindFn(this._dropHandler,this);this.dndOver=!1;b.on("dragenter",this.dragEnterHandler);b.on("dragover",this.dragOverHandler);b.on("dragleave",this.dragLeaveHandler);b.on("drop",this.dropHandler);this.options.disableGlobalDnd&&(c(document).on("dragover",this.dragOverHandler),c(document).on("drop",this.dropHandler))},_dragEnterHandler:function(b){var a=this._denied||
!1,c;b=b.originalEvent||b;this.dndOver||(this.dndOver=!0,(c=b.dataTransfer.items)&&c.length&&(this._denied=a=!this.trigger("accept",c)),this.elem.addClass("webuploader-dnd-over"),this.elem[a?"addClass":"removeClass"]("webuploader-dnd-denied"));b.dataTransfer.dropEffect=a?"none":"copy";return!1},_dragOverHandler:function(b){var a=this.elem.parent().get(0);if(a&&!c.contains(a,b.currentTarget))return!1;clearTimeout(this._leaveTimer);this._dragEnterHandler.call(this,b);return!1},_dragLeaveHandler:function(){var b=
this;clearTimeout(b._leaveTimer);b._leaveTimer=setTimeout(function(){b.dndOver=!1;b.elem.removeClass("webuploader-dnd-over webuploader-dnd-denied")},100);return!1},_dropHandler:function(b){var a=this,f=a.getRuid(),d=a.elem.parent().get(0),e;if(d&&!c.contains(d,b.currentTarget))return!1;b=b.originalEvent||b;b=b.dataTransfer;try{e=b.getData("text/html")}catch(g){}if(!e)return a._getTansferFiles(b,function(b){a.trigger("drop",c.map(b,function(a){return new k(f,a)}))}),a.dndOver=!1,a.elem.removeClass("webuploader-dnd-over"),
!1},_getTansferFiles:function(b,a){var c=[],d=[],e,k,h,p,m,s,v;e=b.items;k=b.files;v=!(!e||!e[0].webkitGetAsEntry);m=0;for(s=k.length;m<s;m++)h=k[m],p=e&&e[m],v&&p.webkitGetAsEntry().isDirectory?d.push(this._traverseDirectoryTree(p.webkitGetAsEntry(),c)):c.push(h);g.when.apply(g,d).done(function(){c.length&&a(c)})},_traverseDirectoryTree:function(b,a){var c=g.Deferred(),d=this;b.isFile?b.file(function(b){a.push(b);c.resolve()}):b.isDirectory&&b.createReader().readEntries(function(b){var k=b.length,
h=[],p=[],m;for(m=0;m<k;m++)h.push(d._traverseDirectoryTree(b[m],p));g.when.apply(g,h).then(function(){a.push.apply(a,p);c.resolve()},c.reject)});return c.promise()},destroy:function(){var b=this.elem;b.off("dragenter",this.dragEnterHandler);b.off("dragover",this.dragEnterHandler);b.off("dragleave",this.dragLeaveHandler);b.off("drop",this.dropHandler);this.options.disableGlobalDnd&&(c(document).off("dragover",this.dragOverHandler),c(document).off("drop",this.dropHandler))}})});p("runtime/html5/filepaste",
["base","runtime/html5/runtime","lib/file"],function(g,h,k){return h.register("FilePaste",{init:function(){var c=this.options,b=this.elem=c.container,a=".*",f,d,e,k;if(c.accept){f=[];d=0;for(e=c.accept.length;d<e;d++)(k=c.accept[d].mimeTypes)&&f.push(k);f.length&&(a=f.join(","),a=a.replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=new RegExp(a,"i");this.hander=g.bindFn(this._pasteHander,this);b.on("paste",this.hander)},_pasteHander:function(c){var b=[],a=this.getRuid(),f,d,e,g,h;c=c.originalEvent||
c;f=c.clipboardData.items;g=0;for(h=f.length;g<h;g++)d=f[g],"file"===d.kind&&(e=d.getAsFile())&&b.push(new k(a,e));b.length&&(c.preventDefault(),c.stopPropagation(),this.trigger("paste",b))},destroy:function(){this.elem.off("paste",this.hander)}})});p("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(g,h){var k=g.$;return h.register("FilePicker",{init:function(){var c=this.getRuntime().getContainer(),b=this,a=b.owner,f=b.options,d=k(document.createElement("label")),e=k(document.createElement("input")),
g,h,p,m;e.attr("type","file");e.attr("name",f.name);e.addClass("webuploader-element-invisible");d.on("click",function(){e.trigger("click")});d.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});f.multiple&&e.attr("multiple","multiple");if(f.accept&&0<f.accept.length){g=[];h=0;for(p=f.accept.length;h<p;h++)g.push(f.accept[h].mimeTypes);e.attr("accept",g.join(","))}c.append(e);c.append(d);m=function(b){a.trigger(b.type)};e.on("change",function(c){var f=
arguments.callee,d;b.files=c.target.files;d=this.cloneNode(!0);d.value=null;this.parentNode.replaceChild(d,this);e.off();e=k(d).on("change",f).on("mouseenter mouseleave",m);a.trigger("change")});d.on("mouseenter mouseleave",m)},getFiles:function(){return this.files},destroy:function(){}})});p("runtime/html5/util",["base"],function(g){var h=y.createObjectURL&&y||y.URL&&URL.revokeObjectURL&&URL||y.webkitURL,k=g=g.noop;h&&(g=function(){return h.createObjectURL.apply(h,arguments)},k=function(){return h.revokeObjectURL.apply(h,
arguments)});return{createObjectURL:g,revokeObjectURL:k,dataURL2Blob:function(c){var b,a,f,d;d=c.split(",");b=~d[0].indexOf("base64")?atob(d[1]):decodeURIComponent(d[1]);c=new ArrayBuffer(b.length);a=new Uint8Array(c);for(f=0;f<b.length;f++)a[f]=b.charCodeAt(f);b=d[0].split(":")[1].split(";")[0];return this.arrayBufferToBlob(c,b)},dataURL2ArrayBuffer:function(c){var b,a;c=c.split(",");c=~c[0].indexOf("base64")?atob(c[1]):decodeURIComponent(c[1]);b=new Uint8Array(c.length);for(a=0;a<c.length;a++)b[a]=
c.charCodeAt(a);return b.buffer},arrayBufferToBlob:function(c,b){var a=y.BlobBuilder||y.WebKitBlobBuilder;return a?(a=new a,a.append(c),a.getBlob(b)):new Blob([c],b?{type:b}:{})},canvasToDataUrl:function(c,b,a){return c.toDataURL(b,a/100)},parseMeta:function(c,b){b(!1,{})},updateImageHead:function(c){return c}}});p("runtime/html5/imagemeta",["runtime/html5/util"],function(g){var h;h={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(k,c){var b=this,a=new FileReader;a.onload=function(){c(!1,
b._parse(this.result));a=a.onload=a.onerror=null};a.onerror=function(b){c(b.message);a=a.onload=a.onerror=null};k=k.slice(0,b.maxMetaDataSize);a.readAsArrayBuffer(k.getSource())},_parse:function(k,c){if(!(6>k.byteLength)){var b=new DataView(k),a=2,f=b.byteLength-4,d=a,e={},g,q;if(65496===b.getUint16(0)){for(;a<f;)if(g=b.getUint16(a),65504<=g&&65519>=g||65534===g){q=b.getUint16(a+2)+2;if(a+q>b.byteLength)break;d=h.parsers[g];if(!c&&d)for(g=0;g<d.length;g+=1)d[g].call(h,b,a,q,e);d=a+=q}else break;6<
d&&(e.imageHead=k.slice?k.slice(2,d):(new Uint8Array(k)).subarray(2,d))}return e}},updateImageHead:function(k,c){var b=this._parse(k,!0),a;a=2;b.imageHead&&(a=2+b.imageHead.byteLength);a=k.slice?k.slice(a):(new Uint8Array(k)).subarray(a);b=new Uint8Array(c.byteLength+2+a.byteLength);b[0]=255;b[1]=216;b.set(new Uint8Array(c),2);b.set(new Uint8Array(a),c.byteLength+2);return b.buffer}};g.parseMeta=function(){return h.parse.apply(h,arguments)};g.updateImageHead=function(){return h.updateImageHead.apply(h,
arguments)};return h});p("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(g,h){var k={ExifMap:function(){return this}};k.ExifMap.prototype.map={Orientation:274};k.ExifMap.prototype.get=function(c){return this[c]||this[this.map[c]]};k.exifTagTypes={1:{getValue:function(c,b){return c.getUint8(b)},size:1},2:{getValue:function(c,b){return String.fromCharCode(c.getUint8(b))},size:1,ascii:!0},3:{getValue:function(c,b,a){return c.getUint16(b,a)},size:2},4:{getValue:function(c,b,
a){return c.getUint32(b,a)},size:4},5:{getValue:function(c,b,a){return c.getUint32(b,a)/c.getUint32(b+4,a)},size:8},9:{getValue:function(c,b,a){return c.getInt32(b,a)},size:4},10:{getValue:function(c,b,a){return c.getInt32(b,a)/c.getInt32(b+4,a)},size:8}};k.exifTagTypes[7]=k.exifTagTypes[1];k.getExifValue=function(c,b,a,f,d,e){f=k.exifTagTypes[f];var h,q;if(f)if(h=f.size*d,q=4<h?b+c.getUint32(a+8,e):a+8,q+h>c.byteLength)g.log("Invalid Exif data: Invalid data offset.");else{if(1===d)return f.getValue(c,
q,e);b=[];for(a=0;a<d;a+=1)b[a]=f.getValue(c,q+a*f.size,e);if(f.ascii){c="";for(a=0;a<b.length;a+=1){d=b[a];if("\x00"===d)break;c+=d}return c}return b}else g.log("Invalid Exif data: Invalid tag type.")};k.parseExifTag=function(c,b,a,f,d){var e=c.getUint16(a,f);d.exif[e]=k.getExifValue(c,b,a,c.getUint16(a+2,f),c.getUint32(a+4,f),f)};k.parseExifTags=function(c,b,a,f,d){var e,k,h;if(a+6>c.byteLength)g.log("Invalid Exif data: Invalid directory offset.");else if(e=c.getUint16(a,f),k=a+2+12*e,k+4>c.byteLength)g.log("Invalid Exif data: Invalid directory size.");
else{for(h=0;h<e;h+=1)this.parseExifTag(c,b,a+2+12*h,f,d);return c.getUint32(k,f)}};k.parseExifData=function(c,b,a,f){a=b+10;var d;if(1165519206===c.getUint32(b+4))if(a+8>c.byteLength)g.log("Invalid Exif data: Invalid segment size.");else if(0!==c.getUint16(b+8))g.log("Invalid Exif data: Missing byte alignment offset.");else{switch(c.getUint16(a)){case 18761:b=!0;break;case 19789:b=!1;break;default:g.log("Invalid Exif data: Invalid byte alignment marker.");return}42!==c.getUint16(a+2,b)?g.log("Invalid Exif data: Missing TIFF marker."):
(d=c.getUint32(a+4,b),f.exif=new k.ExifMap,k.parseExifTags(c,a,a+d,b,f))}};h.parsers[65505].push(k.parseExifData);return k});p("runtime/html5/jpegencoder",[],function(g,h,k){function c(b){function a(a,b){for(var c=0,f=0,d=[],e=1;16>=e;e++){for(var k=1;k<=a[e];k++)d[b[f]]=[],d[b[f]][0]=c,d[b[f]][1]=e,f++,c++;c*=2}return d}function c(a){var b=a[0];for(a=a[1]-1;0<=a;)b&1<<a&&(K|=1<<F),a--,F--,0>F&&(255==K?(d(255),d(0)):d(K),F=7,K=0)}function d(a){N.push(O[a])}function e(a){d(a>>8&255);d(a&255)}function k(a,
b,d,e,g){var w=g[0],v=g[240],h,u,s,n,l,q,m,r,p,t=0;for(h=0;8>h;++h){u=a[t];s=a[t+1];n=a[t+2];l=a[t+3];q=a[t+4];m=a[t+5];r=a[t+6];p=a[t+7];var x=u+p;u-=p;p=s+r;s-=r;r=n+m;n-=m;m=l+q;l-=q;q=x+m;x-=m;m=p+r;p-=r;a[t]=q+m;a[t+4]=q-m;q=.707106781*(p+x);a[t+2]=x+q;a[t+6]=x-q;q=l+n;m=n+s;p=s+u;n=.382683433*(q-p);l=.5411961*q+n;q=1.306562965*p+n;m*=.707106781;n=u+m;u-=m;a[t+5]=u+l;a[t+3]=u-l;a[t+1]=n+q;a[t+7]=n-q;t+=8}for(h=t=0;8>h;++h)u=a[t],s=a[t+8],n=a[t+16],l=a[t+24],q=a[t+32],m=a[t+40],r=a[t+48],p=a[t+
56],x=u+p,u-=p,p=s+r,s-=r,r=n+m,n-=m,m=l+q,l-=q,q=x+m,x-=m,m=p+r,p-=r,a[t]=q+m,a[t+32]=q-m,q=.707106781*(p+x),a[t+16]=x+q,a[t+48]=x-q,q=l+n,m=n+s,p=s+u,n=.382683433*(q-p),l=.5411961*q+n,q=1.306562965*p+n,m*=.707106781,n=u+m,u-=m,a[t+40]=u+l,a[t+24]=u-l,a[t+8]=n+q,a[t+56]=n-q,t++;for(h=0;64>h;++h)t=a[h]*b[h],E[h]=0<t?t+.5|0:t-.5|0;a=E;for(b=0;64>b;++b)D[J[b]]=a[b];a=D[0]-d;d=D[0];0==a?c(e[0]):(h=32767+a,c(e[y[h]]),c(A[h]));for(e=63;0<e&&0==D[e];e--);if(0==e)return c(w),d;for(a=1;a<=e;){for(b=a;0==
D[a]&&a<=e;++a);b=a-b;if(16<=b){h=b>>4;for(t=1;t<=h;++t)c(v);b&=15}h=32767+D[a];c(g[(b<<4)+y[h]]);c(A[h]);a++}63!=e&&c(w);return d}function g(a){0>=a&&(a=1);100<a&&(a=100);if(P!=a){for(var b=0,b=50>a?Math.floor(5E3/a):Math.floor(200-2*a),c=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],f=0;64>f;f++){var d=h((c[f]*b+50)/100);1>d?d=1:255<d&&(d=
255);m[J[f]]=d}c=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(f=0;64>f;f++)d=h((c[f]*b+50)/100),1>d?d=1:255<d&&(d=255),s[J[f]]=d;b=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379];for(f=c=0;8>f;f++)for(d=0;8>d;d++)v[c]=1/(m[J[c]]*b[f]*b[d]*8),w[c]=1/(s[J[c]]*b[f]*b[d]*8),c++;P=a}}var h=Math.floor,m=Array(64),s=Array(64),v=
Array(64),w=Array(64),u,l,n,p,A=Array(65535),y=Array(65535),E=Array(64),D=Array(64),N=[],K=0,F=7,C=Array(64),Q=Array(64),R=Array(64),O=Array(256),z=Array(2048),P,J=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,8,9,10,11],U=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],V=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,
113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,
244,245,246,247,248,249,250],W=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],X=[0,1,2,3,4,5,6,7,8,9,10,11],Y=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Z=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,
163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(a,b){b&&g(b);N=[];K=0;F=7;e(65496);e(65504);e(16);d(74);d(70);d(73);d(70);d(0);d(1);d(1);d(0);e(1);e(1);d(0);d(0);e(65499);e(132);d(0);for(var h=0;64>h;h++)d(m[h]);d(1);for(h=0;64>h;h++)d(s[h]);var h=a.width,x=a.height;e(65472);e(17);d(8);e(x);e(h);d(3);d(1);d(17);d(0);
d(2);d(17);d(1);d(3);d(17);d(1);e(65476);e(418);d(0);for(h=0;16>h;h++)d(S[h+1]);for(h=0;11>=h;h++)d(T[h]);d(16);for(h=0;16>h;h++)d(U[h+1]);for(h=0;161>=h;h++)d(V[h]);d(1);for(h=0;16>h;h++)d(W[h+1]);for(h=0;11>=h;h++)d(X[h]);d(17);for(h=0;16>h;h++)d(Y[h+1]);for(h=0;161>=h;h++)d(Z[h]);e(65498);e(12);d(3);d(1);d(0);d(2);d(17);d(3);d(17);d(0);d(63);d(0);var y=x=h=0;K=0;F=7;this.encode.displayName="_encode_";for(var A=a.data,D=a.height,E=4*a.width,L,M=0,G,H,B,J,I;M<D;){for(L=0;L<E;){J=E*M+L;for(I=0;64>
I;I++)H=I>>3,G=4*(I&7),B=J+H*E+G,M+H>=D&&(B-=E*(M+1+H-D)),L+G>=E&&(B-=L+G-E+4),G=A[B++],H=A[B++],B=A[B++],C[I]=(z[G]+z[H+256>>0]+z[B+512>>0]>>16)-128,Q[I]=(z[G+768>>0]+z[H+1024>>0]+z[B+1280>>0]>>16)-128,R[I]=(z[G+1280>>0]+z[H+1536>>0]+z[B+1792>>0]>>16)-128;h=k(C,v,h,u,n);x=k(Q,w,x,l,p);y=k(R,w,y,l,p);L+=32}M+=8}0<=F&&(h=[],h[1]=F+1,h[0]=(1<<F+1)-1,c(h));e(65497);h="data:image/jpeg;base64,"+btoa(N.join(""));N=[];return h};b||(b=50);(function(){for(var a=String.fromCharCode,b=0;256>b;b++)O[b]=a(b)})();
u=a(S,T);l=a(W,X);n=a(U,V);p=a(Y,Z);(function(){for(var a=1,b=2,c=1;15>=c;c++){for(var f=a;f<b;f++)y[32767+f]=c,A[32767+f]=[],A[32767+f][1]=c,A[32767+f][0]=f;for(f=-(b-1);f<=-a;f++)y[32767+f]=c,A[32767+f]=[],A[32767+f][1]=c,A[32767+f][0]=b-1+f;a<<=1;b<<=1}})();(function(){for(var a=0;256>a;a++)z[a]=19595*a,z[a+256>>0]=38470*a,z[a+512>>0]=7471*a+32768,z[a+768>>0]=-11059*a,z[a+1024>>0]=-21709*a,z[a+1280>>0]=32768*a+8421375,z[a+1536>>0]=-27439*a,z[a+1792>>0]=-5329*a})();g(b)}c.encode=function(b,a){return(new c(a)).encode(b)};
return c});p("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(g,h,k){var c=g.canvasToDataUrl,b;g.canvasToDataUrl=function(a,f,d){var e,g,q;if(!k.os.android)return c.apply(null,arguments);"image/jpeg"===f&&"undefined"===typeof b&&(e=c.apply(null,arguments),e=e.split(","),e=~e[0].indexOf("base64")?atob(e[1]):decodeURIComponent(e[1]),e=e.substring(0,2),b=255===e.charCodeAt(0)&&216===e.charCodeAt(1));return"image/jpeg"!==f||b?c.apply(null,arguments):(g=a.width,
q=a.height,e=a.getContext("2d"),h.encode(e.getImageData(0,0,g,q),d))}});p("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(g,h,k){return h.register("Image",{modified:!1,init:function(){var c=this,b=new Image;b.onload=function(){c._info={type:c.type,width:this.width,height:this.height};c._metas||"image/jpeg"!==c.type?c.owner.trigger("load"):k.parseMeta(c._blob,function(a,b){c._metas=b;c.owner.trigger("load")})};b.onerror=function(){c.owner.trigger("error")};c._img=
b},loadFromBlob:function(c){var b=this._img;this._blob=c;this.type=c.type;b.src=k.createObjectURL(c.getSource());this.owner.once("load",function(){k.revokeObjectURL(b.src)})},resize:function(c,b){var a=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,a,c,b);this._blob=null;this.modified=!0;this.owner.trigger("complete","resize")},crop:function(c,b,a,f,d){var e=this._canvas||(this._canvas=document.createElement("canvas")),k=this.options,h=this._img,g=h.naturalWidth,
m=h.naturalHeight,s=this.getOrientation();d=d||1;e.width=a;e.height=f;k.preserveHeaders||this._rotate2Orientaion(e,s);this._renderImageToCanvas(e,h,-c,-b,g*d,m*d);this._blob=null;this.modified=!0;this.owner.trigger("complete","crop")},getAsBlob:function(c){var b=this._blob,a=this.options;c=c||this.type;if(this.modified||this.type!==c){b=this._canvas;if("image/jpeg"===c){if(b=k.canvasToDataUrl(b,c,a.quality),a.preserveHeaders&&this._metas&&this._metas.imageHead)return b=k.dataURL2ArrayBuffer(b),b=
k.updateImageHead(b,this._metas.imageHead),b=k.arrayBufferToBlob(b,c)}else b=k.canvasToDataUrl(b,c);b=k.dataURL2Blob(b)}return b},getAsDataUrl:function(c){var b=this.options;c=c||this.type;return"image/jpeg"===c?k.canvasToDataUrl(this._canvas,c,b.quality):this._canvas.toDataURL(c)},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(c){return c?(this._info=c,this):this._info},meta:function(c){return c?(this._meta=c,this):this._meta},
destroy:function(){var c=this._canvas;this._img.onload=null;c&&(c.getContext("2d").clearRect(0,0,c.width,c.height),c.width=c.height=0,this._canvas=null);this._img.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";this._img=this._blob=null},_resize:function(c,b,a,f){var d=this.options,e=c.width,k=c.height,h=this.getOrientation(),g;~[5,6,7,8].indexOf(h)&&(a^=f,f^=a,a^=f);g=Math[d.crop?"max":"min"](a/e,f/k);d.allowMagnify||(g=Math.min(1,g));e*=g;k*=g;d.crop?(b.width=a,b.height=f):(b.width=
e,b.height=k);a=(b.width-e)/2;f=(b.height-k)/2;d.preserveHeaders||this._rotate2Orientaion(b,h);this._renderImageToCanvas(b,c,a,f,e,k)},_rotate2Orientaion:function(c,b){var a=c.width,f=c.height,d=c.getContext("2d");switch(b){case 5:case 6:case 7:case 8:c.width=f,c.height=a}switch(b){case 2:d.translate(a,0);d.scale(-1,1);break;case 3:d.translate(a,f);d.rotate(Math.PI);break;case 4:d.translate(0,f);d.scale(1,-1);break;case 5:d.rotate(.5*Math.PI);d.scale(1,-1);break;case 6:d.rotate(.5*Math.PI);d.translate(0,
-f);break;case 7:d.rotate(.5*Math.PI);d.translate(a,-f);d.scale(-1,1);break;case 8:d.rotate(-.5*Math.PI),d.translate(-a,0)}},_renderImageToCanvas:function(){function c(b,a,c){var d=document.createElement("canvas"),e=d.getContext("2d");a=0;var k=c,h=c;d.width=1;d.height=c;e.drawImage(b,0,0);for(b=e.getImageData(0,0,1,c).data;h>a;)d=b[4*(h-1)+3],0===d?k=h:a=h,h=k+a>>1;c=h/c;return 0===c?1:c}return g.os.ios?7<=g.os.ios?function(b,a,f,d,e,k){var h=a.naturalWidth,g=a.naturalHeight,m=c(a,h,g);return b.getContext("2d").drawImage(a,
0,0,h*m,g*m,f,d,e,k)}:function(b,a,f,d,e,h){var k=a.naturalWidth,g=a.naturalHeight;b=b.getContext("2d");var m;var s=a.naturalWidth,v;1048576<s*a.naturalHeight?(v=document.createElement("canvas"),v.width=v.height=1,v=v.getContext("2d"),v.drawImage(a,-s+1,0),m=0===v.getImageData(0,0,1,1).data[3]):m=!1;var w="image/jpeg"===this.type;v=s=0;var u,l;m&&(k/=2,g/=2);b.save();m=document.createElement("canvas");m.width=m.height=1024;u=m.getContext("2d");w=w?c(a,k,g):1;e=Math.ceil(1024*e/k);for(h=Math.ceil(1024*
h/g/w);s<g;){for(l=w=0;w<k;)u.clearRect(0,0,1024,1024),u.drawImage(a,-w,-s),b.drawImage(m,0,0,1024,1024,f+l,d+v,e,h),w+=1024,l+=e;s+=1024;v+=h}b.restore()}:function(b){var a=g.slice(arguments,1),c=b.getContext("2d");c.drawImage.apply(c,a)}}()})});p("runtime/html5/transport",["base","runtime/html5/runtime"],function(g,h){var k=g.noop,c=g.$;return h.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var b=this.owner,a=this.options,f=this._initAjax(),d=b._blob,
k=a.server,h,q,p;a.sendAsBinary?(k+=(/\?/.test(k)?"&":"?")+c.param(b._formData),q=d.getSource()):(h=new FormData,c.each(b._formData,function(a,b){h.append(a,b)}),h.append(a.fileVal,d.getSource(),a.filename||b._formData.name||""));a.withCredentials&&"withCredentials"in f?(f.open(a.method,k,!0),f.withCredentials=!0):f.open(a.method,k);this._setRequestHeader(f,a.headers);q?(f.overrideMimeType("application/octet-stream"),g.os.android?(p=new FileReader,p.onload=function(){f.send(this.result);p=p.onload=
null},p.readAsArrayBuffer(q)):f.send(q)):f.send(h)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var b=this._xhr;b&&(b.upload.onprogress=k,b.onreadystatechange=k,b.abort(),this._xhr=null)},destroy:function(){this.abort()},_initAjax:function(){var b=this,a=new XMLHttpRequest;!this.options.withCredentials||"withCredentials"in a||"undefined"===typeof XDomainRequest||(a=new XDomainRequest);
a.upload.onprogress=function(a){var c=0;a.lengthComputable&&(c=a.loaded/a.total);return b.trigger("progress",c)};a.onreadystatechange=function(){if(4===a.readyState)return a.upload.onprogress=k,a.onreadystatechange=k,b._xhr=null,b._status=a.status,200<=a.status&&300>a.status?(b._response=a.responseText,b.trigger("load")):500<=a.status&&600>a.status?(b._response=a.responseText,b.trigger("error","server")):b.trigger("error",b._status?"http":"abort")};return b._xhr=a},_setRequestHeader:function(b,a){c.each(a,
function(a,c){b.setRequestHeader(a,c)})},_parseJson:function(b){var a;try{a=JSON.parse(b)}catch(c){a={}}return a}})});p("runtime/html5/md5",["runtime/html5/runtime"],function(g){var h=function(a,b){return a+b&4294967295},k=function(a,b,c,f,d,k){b=h(h(b,a),h(f,k));return h(b<<d|b>>>32-d,c)},c=function(a,b,c,f,d,h,e){return k(b&c|~b&f,a,b,d,h,e)},b=function(a,b,c,f,d,h,e){return k(b&f|c&~f,a,b,d,h,e)},a=function(a,b,c,f,d,h,e){return k(c^(b|~f),a,b,d,h,e)},f=function(f,d){var e=f[0],g=f[1],l=f[2],n=
f[3],e=c(e,g,l,n,d[0],7,-680876936),n=c(n,e,g,l,d[1],12,-389564586),l=c(l,n,e,g,d[2],17,606105819),g=c(g,l,n,e,d[3],22,-1044525330),e=c(e,g,l,n,d[4],7,-176418897),n=c(n,e,g,l,d[5],12,1200080426),l=c(l,n,e,g,d[6],17,-1473231341),g=c(g,l,n,e,d[7],22,-45705983),e=c(e,g,l,n,d[8],7,1770035416),n=c(n,e,g,l,d[9],12,-1958414417),l=c(l,n,e,g,d[10],17,-42063),g=c(g,l,n,e,d[11],22,-1990404162),e=c(e,g,l,n,d[12],7,1804603682),n=c(n,e,g,l,d[13],12,-40341101),l=c(l,n,e,g,d[14],17,-1502002290),g=c(g,l,n,e,d[15],
22,1236535329),e=b(e,g,l,n,d[1],5,-165796510),n=b(n,e,g,l,d[6],9,-1069501632),l=b(l,n,e,g,d[11],14,643717713),g=b(g,l,n,e,d[0],20,-373897302),e=b(e,g,l,n,d[5],5,-701558691),n=b(n,e,g,l,d[10],9,38016083),l=b(l,n,e,g,d[15],14,-660478335),g=b(g,l,n,e,d[4],20,-405537848),e=b(e,g,l,n,d[9],5,568446438),n=b(n,e,g,l,d[14],9,-1019803690),l=b(l,n,e,g,d[3],14,-187363961),g=b(g,l,n,e,d[8],20,1163531501),e=b(e,g,l,n,d[13],5,-1444681467),n=b(n,e,g,l,d[2],9,-51403784),l=b(l,n,e,g,d[7],14,1735328473),g=b(g,l,n,e,
d[12],20,-1926607734),e=k(g^l^n,e,g,d[5],4,-378558),n=k(e^g^l,n,e,d[8],11,-2022574463),l=k(n^e^g,l,n,d[11],16,1839030562),g=k(l^n^e,g,l,d[14],23,-35309556),e=k(g^l^n,e,g,d[1],4,-1530992060),n=k(e^g^l,n,e,d[4],11,1272893353),l=k(n^e^g,l,n,d[7],16,-155497632),g=k(l^n^e,g,l,d[10],23,-1094730640),e=k(g^l^n,e,g,d[13],4,681279174),n=k(e^g^l,n,e,d[0],11,-358537222),l=k(n^e^g,l,n,d[3],16,-722521979),g=k(l^n^e,g,l,d[6],23,76029189),e=k(g^l^n,e,g,d[9],4,-640364487),n=k(e^g^l,n,e,d[12],11,-421815835),l=k(n^
e^g,l,n,d[15],16,530742520),g=k(l^n^e,g,l,d[2],23,-995338651),e=a(e,g,l,n,d[0],6,-198630844),n=a(n,e,g,l,d[7],10,1126891415),l=a(l,n,e,g,d[14],15,-1416354905),g=a(g,l,n,e,d[5],21,-57434055),e=a(e,g,l,n,d[12],6,1700485571),n=a(n,e,g,l,d[3],10,-1894986606),l=a(l,n,e,g,d[10],15,-1051523),g=a(g,l,n,e,d[1],21,-2054922799),e=a(e,g,l,n,d[8],6,1873313359),n=a(n,e,g,l,d[15],10,-30611744),l=a(l,n,e,g,d[6],15,-1560198380),g=a(g,l,n,e,d[13],21,1309151649),e=a(e,g,l,n,d[4],6,-145523070),n=a(n,e,g,l,d[11],10,-1120210379),
l=a(l,n,e,g,d[2],15,718787259),g=a(g,l,n,e,d[9],21,-343485551);f[0]=h(e,f[0]);f[1]=h(g,f[1]);f[2]=h(l,f[2]);f[3]=h(n,f[3])},d=function(a){var b=[],c;for(c=0;64>c;c+=4)b[c>>2]=a.charCodeAt(c)+(a.charCodeAt(c+1)<<8)+(a.charCodeAt(c+2)<<16)+(a.charCodeAt(c+3)<<24);return b},e=function(a){var b=[],c;for(c=0;64>c;c+=4)b[c>>2]=a[c]+(a[c+1]<<8)+(a[c+2]<<16)+(a[c+3]<<24);return b},p=function(a){var b=a.length,c=[1732584193,-271733879,-1732584194,271733878],e,g,h;for(e=64;e<=b;e+=64)f(c,d(a.substring(e-64,
e)));a=a.substring(e-64);g=a.length;h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<g;e+=1)h[e>>2]|=a.charCodeAt(e)<<(e%4<<3);h[e>>2]|=128<<(e%4<<3);if(55<e)for(f(c,h),e=0;16>e;e+=1)h[e]=0;b=(8*b).toString(16).match(/(.*?)(.{0,8})$/);a=parseInt(b[2],16);b=parseInt(b[1],16)||0;h[14]=a;h[15]=b;f(c,h);return c},q="0123456789abcdef".split(""),x=function(a){var b;for(b=0;b<a.length;b+=1){for(var c=b,e=a[b],d="",f=void 0,f=0;4>f;f+=1)d+=q[e>>8*f+4&15]+q[e>>8*f&15];a[c]=d}return a.join("")},m=function(){this.reset()};
"5d41402abc4b2a76b9719d911017c592"!==x(p("hello"))&&(h=function(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535});m.prototype.append=function(a){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));this.appendBinary(a);return this};m.prototype.appendBinary=function(a){this._buff+=a;this._length+=a.length;a=this._buff.length;var b;for(b=64;b<=a;b+=64)f(this._state,d(this._buff.substring(b-64,b)));this._buff=this._buff.substr(b-64);return this};m.prototype.end=function(a){var b=
this._buff,c=b.length,e,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<c;e+=1)d[e>>2]|=b.charCodeAt(e)<<(e%4<<3);this._finish(d,c);a=a?this._state:x(this._state);this.reset();return a};m.prototype._finish=function(a,b){var c=b,e;a[c>>2]|=128<<(c%4<<3);if(55<c)for(f(this._state,a),c=0;16>c;c+=1)a[c]=0;e=8*this._length;e=e.toString(16).match(/(.*?)(.{0,8})$/);c=parseInt(e[2],16);e=parseInt(e[1],16)||0;a[14]=c;a[15]=e;f(this._state,a)};m.prototype.reset=function(){this._buff="";this._length=0;this._state=
[1732584193,-271733879,-1732584194,271733878];return this};m.prototype.destroy=function(){delete this._state;delete this._buff;delete this._length};m.hash=function(a,b){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));var c=p(a);return b?c:x(c)};m.hashBinary=function(a,b){var c=p(a);return b?c:x(c)};m.ArrayBuffer=function(){this.reset()};m.ArrayBuffer.prototype.append=function(a){var b=this._concatArrayBuffer(this._buff,a),c=b.length;this._length+=a.byteLength;for(a=64;a<=c;a+=64)f(this._state,
e(b.subarray(a-64,a)));this._buff=a-64<c?b.subarray(a-64):new Uint8Array(0);return this};m.ArrayBuffer.prototype.end=function(a){var b=this._buff,c=b.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d;for(d=0;d<c;d+=1)e[d>>2]|=b[d]<<(d%4<<3);this._finish(e,c);a=a?this._state:x(this._state);this.reset();return a};m.ArrayBuffer.prototype._finish=m.prototype._finish;m.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];
return this};m.ArrayBuffer.prototype.destroy=m.prototype.destroy;m.ArrayBuffer.prototype._concatArrayBuffer=function(a,b){var c=a.length,e=new Uint8Array(c+b.byteLength);e.set(a);e.set(new Uint8Array(b),c);return e};m.ArrayBuffer.hash=function(a,b){var c=new Uint8Array(a),d=c.length,g=[1732584193,-271733879,-1732584194,271733878],h,k,m;for(h=64;h<=d;h+=64)f(g,e(c.subarray(h-64,h)));c=h-64<d?c.subarray(h-64):new Uint8Array(0);k=c.length;m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;h<k;h+=1)m[h>>2]|=
c[h]<<(h%4<<3);m[h>>2]|=128<<(h%4<<3);if(55<h)for(f(g,m),h=0;16>h;h+=1)m[h]=0;d=(8*d).toString(16).match(/(.*?)(.{0,8})$/);c=parseInt(d[2],16);d=parseInt(d[1],16)||0;m[14]=c;m[15]=d;f(g,m);return b?g:x(g)};return g.register("Md5",{init:function(){},loadFromBlob:function(a){var b=a.getSource(),c=Math.ceil(b.size/2097152),e=0,d=this.owner,f=new m.ArrayBuffer,g=this,h=b.mozSlice||b.webkitSlice||b.slice,k,q;q=new FileReader;k=function(){var m,p;m=2097152*e;p=Math.min(m+2097152,b.size);q.onload=function(b){f.append(b.target.result);
d.trigger("progress",{total:a.size,loaded:p})};q.onloadend=function(){q.onloadend=q.onload=null;++e<c?setTimeout(k,1):setTimeout(function(){d.trigger("load");g.result=f.end();k=a=b=f=null;d.trigger("complete")},50)};q.readAsArrayBuffer(h.call(b,m,p))};k()},getResult:function(){return this.result}})});p("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(g,h,k){function c(){function b(a,c){var d=a.type||a,f,d=d.split("::");f=d[0];d=d[1];"Ready"===d&&f===q.uid?q.trigger("ready"):
e[f]&&e[f].trigger(d.toLowerCase(),a,c)}var c={},e={},k=this.destory,q=this,p=g.guid("webuploader_");h.apply(q,arguments);q.type="flash";q.exec=function(b,f){var h=this.uid,k=g.slice(arguments,2);e[h]=this;return a[b]&&(c[h]||(c[h]=new a[b](this,q)),h=c[h],h[f])?h[f].apply(h,k):q.flashExec.apply(this,arguments)};y[p]=function(){var a=arguments;setTimeout(function(){b.apply(null,a)},1)};this.jsreciver=p;this.destory=function(){return k&&k.apply(this,arguments)};this.flashExec=function(a,b){var c=q.getFlash(),
e=g.slice(arguments,2);return c.exec(this.uid,a,b,e)}}var b=g.$,a={};g.inherits(h,{constructor:c,init:function(){var a=this.getContainer(),b=this.options,c;a.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});c='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+b.swf+'" ';g.browser.ie&&(c+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');c+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+b.swf+'" /><param name="flashvars" value="uid='+
this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';a.html(c)},getFlash:function(){return this._flash?this._flash:this._flash=b("#"+this.uid).get(0)}});c.register=function(c,d){return d=a[c]=g.inherits(k,b.extend({flashExec:function(){var a=this.owner;return this.getRuntime().flashExec.apply(a,arguments)}},d))};11.4<=function(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(b){try{a=
(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(c){a="0.0"}}a=a.match(/\d+/g);return parseFloat(a[0]+"."+a[1],10)}()&&h.addRuntime("flash",c);return c});p("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(g,h){var k=g.$;return h.register("FilePicker",{init:function(c){c=k.extend({},c);var b,a;b=c.accept&&c.accept.length;for(a=0;a<b;a++)c.accept[a].title||(c.accept[a].title="Files");delete c.button;delete c.id;delete c.container;this.flashExec("FilePicker",
"init",c)},destroy:function(){}})});p("runtime/flash/image",["runtime/flash/runtime"],function(g){return g.register("Image",{loadFromBlob:function(g){var k=this.owner;k.info()&&this.flashExec("Image","info",k.info());k.meta()&&this.flashExec("Image","meta",k.meta());this.flashExec("Image","loadFromBlob",g.uid)}})});p("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(g,h,k){var c=g.$;return h.register("Transport",{init:function(){this._status=0;this._responseJson=
this._response=null},send:function(){var b=this.owner,a=this.options,f=this._initAjax(),d=b._blob,e=a.server,g;f.connectRuntime(d.ruid);a.sendAsBinary?(e+=(/\?/.test(e)?"&":"?")+c.param(b._formData),g=d.uid):(c.each(b._formData,function(a,b){f.exec("append",a,b)}),f.exec("appendBlob",a.fileVal,d.uid,a.filename||b._formData.name||""));this._setRequestHeader(f,a.headers);f.exec("send",{method:a.method,url:e,mimeType:"application/octet-stream"},g)},getStatus:function(){return this._status},getResponse:function(){return this._response||
""},getResponseAsJson:function(){return this._responseJson},abort:function(){var b=this._xhr;b&&(b.exec("abort"),b.destroy(),this._xhr=null)},destroy:function(){this.abort()},_initAjax:function(){var b=this,a=new k("XMLHttpRequest");a.on("uploadprogress progress",function(a){a=a.loaded/a.total;a=Math.min(1,Math.max(0,a));return b.trigger("progress",a)});a.on("load",function(){var c=a.exec("getStatus"),d="";a.off();b._xhr=null;200<=c&&300>c?(b._response=a.exec("getResponse"),b._responseJson=a.exec("getResponseAsJson")):
500<=c&&600>c?(b._response=a.exec("getResponse"),b._responseJson=a.exec("getResponseAsJson"),d="server"):d="http";b._response=decodeURIComponent(b._response);a.destroy();a=null;return d?b.trigger("error",d):b.trigger("load")});a.on("error",function(){a.off();b._xhr=null;b.trigger("error","http")});return b._xhr=a},_setRequestHeader:function(b,a){c.each(a,function(a,c){b.exec("setRequestHeader",a,c)})}})});p("runtime/flash/md5",["runtime/flash/runtime"],function(g){return g.register("Md5",{init:function(){},
loadFromBlob:function(g){return this.flashExec("Md5","loadFromBlob",g.uid)}})});p("preset/all","base widgets/filednd widgets/filepaste widgets/filepicker widgets/image widgets/queue widgets/runtime widgets/upload widgets/validator widgets/md5 runtime/html5/blob runtime/html5/dnd runtime/html5/filepaste runtime/html5/filepicker runtime/html5/imagemeta/exif runtime/html5/androidpatch runtime/html5/image runtime/html5/transport runtime/html5/md5 runtime/flash/filepicker runtime/flash/image runtime/flash/transport runtime/flash/md5".split(" "),
function(g){return g});p("webuploader",["preset/all"],function(g){return g});return C("webuploader")});